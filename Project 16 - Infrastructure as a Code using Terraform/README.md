# Infrastructure as a Code (Iac) using Terraform in AWS

nfrastructure as Code (IaC) is a methodology that involves managing and provisioning computing infrastructure through machine-readable script files, rather than through physical hardware configuration or interactive configuration tools. With IaC, you describe your infrastructure's configuration using a high-level programming language or a domain-specific language (DSL), and then use a tool to automate the provisioning and management of those resources.

**Terraform** is an open-source Infrastructure as Code (IaC) tool developed by _HashiCorp_. It allows users to define and provision infrastructure resources in a declarative configuration language. With Terraform, you can manage and automate the deployment of infrastructure across various cloud providers such as AWS, as well as on-premises environments.

In the previous project [Implementing Networking Concepts in AWS](https://github.com/iamYole/DIO-Projects/tree/main/Project%2015%20-%20Networking%20in%20AWS), we designed an architecture consisting of a VPC with public and private subnets, and then we created several EC2 Instances for the public and private subnets. The architecture was created by clicking through several windowns and menus in the AWS Console. In this project, we will be designing the same architecture, but using Terraform IaC.

### Part 1 - The prerequisites

Before we begin, there are some prerequisites that needs to be completed:

- Install Terraform
- Create an _IAM User_ in AWS and an _Access Key_
- Install AWS CLI on a local maching
- Configure the created _IAM User_ to have programatic and adminstrative access to your AWS Console

### Part 2 - Creating the Infrastructure

Let's start by creating the VPC.

- Create a folder called IaC, and within the folder, create a file called main.tf. I'll be using VS Code editor for the code.
  ![Alt text](Images/Img_01.png)

- In the main.tf file, copy and paste the code below:

> ```bash
> provider "aws" {
>  region = "eu-west-2"
> }
>
> # Create VPC
>  resource "aws_vpc" "dio-vpc" {
>  cidr_block                     = "172.16.0.0/16"
>  enable_dns_support             = "true"
>  enable_dns_hostnames           = "true"
>
>  tags {
>    Name = "dio-vpc"
>  }
> }
> ```

- The code above creates a VPC called `dio-vpc` in AWS region `eu-west-2`. You can choose any region of your choice. The VPC is created using the CIDR Block `172.16.0.0/16`.

- The next step is to initialise the workspace for Terraform to download the necessary plugins to create the resources. To do this, from the terminal, navigate the the directory location or open the terminal window from VS Code and then run `terraform init`.

  ![Alt text](Images/Img_02.png)

- The workspace has been initialised, and Terraform has created a new directory within the workspace called `.terraform` as well as some .tf files to hold the state of our resources at all time.

- After Terraform has initialised the workspace, its we can start creating our resources using code. To confirm our code has been properly written, we can run `terraform validate`. This should give a success message if there are no syntax errors or it will return an error massage.
- If the configuration has been validated sucessfully, the next step is to run `terraform plan`. This command is used to generate an execution plan. It helps you understand what changes Terraform will make to your infrastructure before actually applying those changes.

  ![Alt text](Images/Img_03.png)
  From the Image above, we can see that 1 resource would be created/add, 0 would be changed/modified and 0 would be destrory.

        It is very important to run this command before applying any changes. That is because some modifications to the configuration file can just change some settings, while some will delete the resource completely, and recreate it again. Hence inspecting the outcome of the terraform plan command can be very helpful.

- If we are satisfied with the changes to be made, we simply run `terraform apply`. This command will execute the execution plan generated by the `terraform apply` command. This command with create the actual resources on AWS.
- Now, run the `terraform apply` command and verify a VPC named `dio-vpc` has been created on AWS in the region specified.

  ![Alt text](Images/Img_04.png)

  From the image above, it took just 12sec to create VPC after running the terraform apply command. Now the VPC is pretty empty, and we will appriciate the value of IaC more when deploying multiple resources.
  ![Alt text](Images/Img_05.png)

Now, let's create the subnets:

- In the `main.tf` file, copy and paste the code below:

  > ```bash
  > # Create public subnets1
  > resource "aws_subnet" "pub_sub_1" {
  >   vpc_id                  = aws_vpc.dio-vpc.id
  >   cidr_block              = "172.16.0.0/24"
  >   map_public_ip_on_launch = true
  >   availability_zone       = "eu-central-1a"
  >
  >  tags = {
  >     Name = "pub_sub_1"
  >  }
  >
  > }
  >
  > # Create public subnet2
  > resource "aws_subnet" "pub_sub_2" {
  >   vpc_id                  = aws_vpc.dio-vpc.id
  >   cidr_block              = "172.16.1.0/24"
  >   map_public_ip_on_launch = true
  >   availability_zone       = "eu-central-1b"
  > }
  >
  >  tags = {
  >      Name = "pub_sub_2"
  > }
  > ```

- The code above created two subnets titeled `pub_sub_1` and `pub_sub_2` using the vpc_id of `dio-vpc` created initially.
- Again, run the `terraform validate`, `terraform plan`, and then `terraform apply` to create the subnets.
  ![Alt text](Images/Img_06.png)

### Part 3 - Refactoring the Code

In the previous section, created a VPC and two subnets, but values of several attibutes were hard coded. For example, the values of the region and availablity zone were hard coded. We can make the code look better and easier to manage by introducing variables.

Now, let's run `terraform destory` to delete everything we've created so far, and then recreate the infrastructure using a well written configuration insted. Confirm the VPC and subnets have been deleted from the AWS Console and let's start again.
